<!doctype html>
<html lang="en">
<!--
    License
    Rethinking Loops by John Kary <johnkary@gmail.com> is licensed under a Creative Commons Attribution-ShareAlike 4.0 International License. <http://creativecommons.org/licenses/by-sa/4.0/>

    Reveal.js License <https://github.com/hakimel/reveal.js/blob/3.2.0/LICENSE>
-->
	<head>
		<meta charset="utf-8">

		<title>Rethinking Loops</title>

		<meta name="description" content="Rethinking Loops">
		<meta name="author" content="John Kary">

		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/simple.css" id="theme">
		<link rel="stylesheet" href="css/custom.css">

		<!-- Code syntax highlighting -->
		<link rel="stylesheet" href="lib/css/idea.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>

		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>

	<body>

		<div class="reveal">

			<div class="slides">
				<section data-background="images/questions-bg.jpg">
					<h1 style="margin-top:1.2em;margin-bottom:1em">Rethinking Loops</h1>
					<p>John Kary</a> &nbsp;â€¢&nbsp; @johnkary</p>
				</section>

                <section>
                    <img src="images/kcpug.png" class="no-border">
                </section>

                <!--
                we're going to look at a lot of code today. the catch is really bad code
                that benefits the most from the techniques I'll talk about today is hard to show
                on slides because that bad code is long and hard to follow. 
                I hope looking at "simple" bad code examples you can recognize these bad
                coding patterns in the code you work with.
            -->

                <section>
                    <h3>FizzBuzz</h3>
                    <p class="fragment" style="text-align:left">
                        Print numbers from 1 to 100, but...<br>
                        For multiples of 3 print "Fizz"<br>
                        For multiples of 5 print "Buzz"<br>
                        For multiples of both 3 and 5 print "FizzBuzz"
                    </p>
                </section>

                <section>
                    <pre style="width:25%"><code data-trim>
$ php fizzbuzz.php
1
2
Fizz
4
Buzz
Fizz
7
8
Fizz
Buzz
11
Fizz
13
14
FizzBuzz
16
...
Buzz
</code></pre>
                </section>

                <section>
                    <pre style="width:50%"><code class="php" data-trim>
foreach (range(1,100) as $num) {
    $output = '';

    if (0 === $num % 3) {
        $output .= 'Fizz';
    }

    if (0 === $num % 5) {
        $output .= 'Buzz';
    }

    if (!$output) {
        $output = $num;
    }

    echo $output . "\n";
}
</code></pre>
                </section>

                <section>
                    <img src="images/kata.png" class="stretch no-border">
                    <!-- https://twitter.com/johnkary/status/596107001563848705 -->
                </section>
                
                <section>
                    <pre><code class="php" data-trim>
$max = 100;
$all = range(1, $max);
$threes = array_fill_keys(range(3, $max, 3), 'Fizz'); // [3 => 'Fizz', 6 => 'Fizz']
$fives = array_fill_keys(range(5, $max, 5), 'Buzz');  // [5 => 'Buzz', 10 => 'Buzz']
$fifteens = array_fill_keys(range(15, $max, 15), 'FizzBuzz'); // [15 => 'FizzBuzz']

echo join("\n", array_replace($all, $threes, $fives, $fifteens));
</code></pre>
                    <small><a href="https://gist.github.com/jrmadsen67/5815505">By Jeff Madsen @codebyjeff</a></small>
                </section>

                <section data-transition="none">
                    <p>What if we used arrays for (almost) everything?</p>
                    <p class="fragment">Collection Oriented Programming</p>
                    <p class="fragment">APL (1960s)<br><img src="images/apl.png"></p>
                    <p class="fragment">J (1990)<br><img src="images/j.png"></p>
                </section>

                <section>
                    <p>What if we used arrays for (almost) everything?</p>
                    <h3 class="fragment">Functional Programming</h3>
                </section>

                <section>
                    Clojure (2007)
                    <pre><code class="clojure" data-trim>
(defn encode
  [#^InputStream input #^Writer output #^String alphabet line-length]
  (let [buffer (make-array Byte/TYPE 3)]
    (loop [line 0]
      (let [len (.read input buffer)]
        (when (pos? len)
          (let [b0 (Integer/valueOf (int (aget buffer 0)))
                b1 (Integer/valueOf (int (aget buffer 1)))
                b2 (Integer/valueOf (int (aget buffer 2)))]
            (cond (= len 3)
                  (let [s0 (bit-and 0x3F (bit-shift-right b0 2))
                        s1 (bit-and 0x3F
                                    (bit-or (bit-shift-left b0 4)
                                            (bit-shift-right b1 4)))
                        s2 (bit-and 0x3F
                                    (bit-or (bit-shift-left b1 2)
                                            (bit-shift-right b2 6)))
                        s3 (bit-and 0x3F b2)]
                    (.append output (.charAt alphabet s0))
                    (.append output (.charAt alphabet s1))
                    (.append output (.charAt alphabet s2))
                    (.append output (.charAt alphabet s3))))))))))
</code></pre>
                </section>

                <section>
                    <h3>Functional Programming Concepts</h3>
                </section>

                <section>
                    <h4>Map</h4>
                    <pre>
1,                  2,
2,                  4,
3,  -->  f(x)  -->  6,
4,                  8,
5,                  10,
</pre>

                    <pre class="fragment"><code class="php" data-trim>
// array_map ( callable $callback , array $array1 [, array $... ] )

$start = [1, 2, 3, 4, 5];
$fn = function ($i) {
    return $i * 2;
};
$end = array_map($fn, $start);

// [2, 4, 6, 8, 10]
</code></pre>
                </section>

                <section>
                    <h5>Filter</h5>
                    <pre>
1,
2,                  2,
3,  -->  f(x)  -->
4,                  4,
5,
6,                  6,
</pre>
                    <pre class="fragment"><code class="php" data-trim>
// array_filter ( array $array [, callable $callback [, int $flag = 0 ]] )

$start = [1, 2, 3, 4, 5, 6];
$even = array_filter($start, function ($i) {
    return $i % 2 === 0;
});

// [2, 4, 6]
</code></pre>
                </section>

                <section>
                    <h5>Reduce</h5>
                    <pre>
1,
2,
3,  -->  f(x)  -->  15
4,
5,
</pre>
                    <pre class="fragment"><code class="php stretch" data-trim>
// array_reduce ( array $array , callable $callback [, mixed $initial = NULL ] )

$start = [1, 2, 3, 4, 5];
$end = array_reduce($start, function ($total, $i) {
    return $total + $i;
}, 0);

// 15
</code></pre>
                </section>

                <section>
                    <img src="images/voltron.jpg" class="no-border">
                    <p>Voltron: teaching kids distributed computing since 1984<br><small style="margin-top:0.5em">Chris Paul <img src="images/twitter-logo.png" class="no-border" style="width:20px;margin:6px 4px 0 6px"> @idiosynchris</small></p>
                </section>

                <section>
                    <h3>Expressive Language</h3>
                    <img src="images/wolves.png" class="no-border fragment">
                </section>

                <section data-transition="none">
                    <h5>Expressive Language</h5>

                    <ul class="fragment">
                        <li>Chess is <span class="red">cool</span></li>
                        <li class="fragment">Roller coasters are <span class="red">cool</span></li>
                        <li class="fragment">Playing chess on a roller coaster is <span class="red">cool</span></li>
                    </ul>
                </section>

                <section data-transition="none">
                    <img src="images/chess-roller-coaster.png" style="max-width:41%;" class="no-border">
                </section>

                <section data-transition="none">
                    <h5>Expressive Language</h5>

                    <ul>
                        <li>Chess is <span class="red">contemplative</span></li>
                        <li class="fragment">Roller coasters are <span class="red">thrilling</span></li>
                        <li class="fragment">Playing chess on a roller coaster is <span class="red">connivingly rebellious</span></li>
                    </ul>
                </section>

                <section>
                    <h3>Expressive Code</h3>
                </section>

                <section>
                    <h5 class="fragment">array_map</h5>
<pre><code class="php" data-trim>
$start = [1, 2, 3, 4, 5];
$end = [];

for ($i=0; $i < count($start); $i++) {
    $current = $start[$i];
    $end[] = $current * 2;
}

// $end [2, 4, 6, 8, 10]
</code></pre>
<pre class="fragment"><code class="php" data-trim>
$start = [1, 2, 3, 4, 5];
$end = array_map(function ($i) {
    return $i * 2;
}, $start);

// $end [2, 4, 6, 8, 10]
</code></pre>
                </section>

                <section>
                    <h5 class="fragment">array_filter</h5>
<pre><code class="php" data-trim>
$start = [1, 2, 3, 4, 5, 6];
$even = [];

foreach ($start as $i) {
    if ($i % 2 === 0) {
        $even[] = $i;
    }
}

// $even [2, 4, 6]
</code></pre>
<pre class="fragment"><code class="php" data-trim>
$start = [1, 2, 3, 4, 5, 6];
$even = array_filter($start, function ($i) {
    return $i %2 === 0;
});

// $even [2, 4, 6]
</code></pre>
                </section>

                <section>
                    <h5 class="fragment">array_reduce</h5>
                    <pre><code class="php stretch" data-trim>
$scores = [1, 2, 3, 4, 5];
$sum = 0;

foreach ($scores as $s) {
    $sum = $sum + $s;
}

// $sum === 15
</code></pre>
<pre class="fragment"><code class="php stretch" data-trim>
$scores = [1, 2, 3, 4, 5];
$sum = array_reduce($scores, function ($end, $i) {
    return $end + $i;
}, 0);

// $sum === 15
// $sum = array_sum($start);
</code></pre>
                </section>

                <section>
                    <img src="images/functions-in-out.png" class="stretch no-border">
                </section>

                <section data-transition="none">
                    <h3>Callables</h3>
                </section>

                <section data-transition="none">
                    <h5>Global functions</h5>
                    <pre><code class="php" data-trim>
function sayHello($name) {
    return 'Hello ' . $name;
}

echo sayHello('John'); // "Hello John"
</code></pre>
                </section>

                <section data-transition="none">
                    <h5>Static functions</h5>
                    <pre><code class="php" data-trim>
class User {
    public static function sayHello($name) {
        return 'Hello ' . $name;
    }
}

echo User::sayHello("John"); // "Hello John"
</code></pre>
                </section>

                <section data-transition="none">
                    <h5>Object methods</h5>
                    <pre><code class="php" data-trim>
class User {
    private $name;

    public function __construct($name) {
        $this->name = $name;
    }

    public function getGreeting() {
        return 'Hello ' . $this->name;
    }
}

$user = new User("John");
echo $user->getGreeting(); // "Hello John"
</code></pre>
                </section>

                <section data-transition="none">
                    <h5>Anonymous functions</h5>
                    <pre><code class="php" data-trim>
$greeting = function ($name) {
    return 'Hello ' . $name;
};

echo $greeting('John'); // "Hello John"
</code></pre>
                </section>

                <section data-transition="none">
                    <h3>Scope</h3>
                </section>

                <section>
                    <h5>Local Variables</h5>
                    <!--
                    Variables outside function are not accessible inside
                    We control what goes in and what comes out
                -->
                    <pre><code class="php" data-trim class="stretch">
$method = "GET";

sayHello('John');

function sayHello($name) {
    return 'Hello ' . $name . ' via ' . $method;
    // PHP Notice:  Undefined variable: method
}
</code></pre>
                </section>

                <section data-transition="none">
                    <h5>Global Variables</h5>
                    <!-- global keyword brings in variables -->
                    <pre><code class="php" data-trim class="stretch">
$method = "GET";

sayHello('John');
// "Hello John via GET"

function sayHello($name) {
    global $method;
    return 'Hello ' . $name . ' via ' . $method;
}
</code></pre>
                </section>

                <section data-transition="none">
                    <h5>Closure Variables</h5>
                    <!-- Another is `use` when using closures -->
                    <pre><code class="php" data-trim class="stretch">
$method = "GET";

$greeting = function($name) use ($method) {
    return sprintf('Hello %s via %s', $name, $method);
};

echo $greeting('John'); // "Hello John via GET"
</code></pre>
                </section>

                <section>
                    <h5>array_* accepts many callables</h5>
                    <pre><code class="php" data-trim>
class User {
    private $name, $age;

    public static function fromArray(array $data)
    {
        $u = new User;
        $u->name = $data['name'];
        $u->age = $data['age'];
        return $u;
    }
}
</code></pre>
                </section>
                <section>
                    <h5>array_* accepts all callables</h5>
                    <pre><code class="php" data-trim>
$rows = [
    ['name' => 'Sarah',  'age' => 58],
    ['name' => 'Matt',   'age' => 52],
    ['name' => 'Mickey', 'age' => 42],
];

// Anonymous
$build = function(array $row) {
    return User::fromArray($row);
};
$users = array_map($build, $rows);
</code></pre>
<pre class="fragment"><code class="php" data-trim>
// Below are all equivalent
$users = array_map('User::fromArray', $rows);
$users = array_map(['User', 'fromArray'], $rows);

$u = new User();
$users = array_map([$u, 'fromArray'], $rows);
</code></pre>
                </section>

                <section>
                    <!--
                        Consistent scope is good because it explicitly documents what is accessible
                        This puts less strain on our working memory
                    -->
                    <img src="images/functions-in-out.png" class="stretch no-border">
                </section>

                <section>
                    <h3>Be nice to your brain!</h3>
                </section>

                <section>
                    <pre><code class="php" data-trim>
for ($i = 0, $for_max = count($cached_inserts); $i < $for_max; $i++) {
    if ($smarty->debugging) {
        $_params = array();
        require_once(SMARTY_CORE_DIR . 'core.get_microtime.php');
    }
    $args = unserialize($insert_args[$i]); $name = $args['name'];

    if (isset($args['script'])) {
        if(!smarty_core_get_php_resource($_params, $smarty)) {
            return false;
        }
        $php_resource = $_params['php_resource'];

        if ($resource_type == 'file') {
            $smarty->_include($php_resource, true);
        } else {
            $smarty->_eval($php_resource);
        }
    }

    $params['results'] = substr_replace($params['results'], $replace, strpos($params['results'], $cached_inserts[$i]), strlen($cached_inserts[$i]));
    if ($smarty->debugging) {
        $_params = array();
        require_once(SMARTY_CORE_DIR . 'core.get_microtime.php');
        $smarty->_smarty_debug_info[] = array('type'      => 'insert',
                                              'exec_time' => smarty_core_get_microtime($_params, $smarty) - $debug_start_time);
    }
}

return $params['results'];
</code></pre>
                </section>

                <section data-transition="none">
                    <pre><span style="color: transparent; text-shadow: rgba(0, 0, 0, 0.95) 0px 0px 10px;">for ($i = 0, $for_max = count($cached_inserts); $i < $for_max; $i++) {
function doComplicatedThing() {
    for ($i = 0, $for_max = count($cached_inserts); $i < $for_max; $i++) {
        if ($smarty->debugging) {
            $_params = array();
            require_once(SMARTY_CORE_DIR . 'core.get_microtime.php');
        }
        $args = unserialize($insert_args[$i]); $name = $args['name'];

        if (isset($args['script'])) {
            if(!smarty_core_get_php_resource($_params, $smarty)) {
                return false;
            }
            $php_resource = $_params['php_resource'];

            if ($resource_type == 'file') {
                $smarty->_include($php_resource, true);
            } else {
                $smarty->_eval($php_resource);
            }
        }

        $params['results'] = substr_replace($params['results'], $replace, strpos($params['results'], $cached_inserts[$i]), strlen($cached_inserts[$i]));
        if ($smarty->debugging) {
            $_params = array();
            require_once(SMARTY_CORE_DIR . 'core.get_microtime.php');
            $smarty->_smarty_debug_info[] = array('type'      => 'insert',
                                                  'exec_time' => smarty_core_get_microtime($_params, $smarty) - $debug_start_time);
        }
    }

    return $params['results'];
}
</span></pre>
                </section>

                <section>
                <!--
                    controlling what goes in and what comes out
                    is clear what is required to use this method properly
                    and what it will return
                -->
                    <h3>Working Memory</h3>
                </section>

                <section>
                    <h3>Dogs, Strips of Bacon, Gina</h3>
                    <ul>
                        <li class="fragment">3 dogs run into the your living room</li>
                        <li class="fragment">Gina feeds each dog a strip of bacon
                            <ul class="fragment"><li>except Spackle because he pooped on the floor earlier</li></ul></li>
                        <li class="fragment">Spot wags her tail looking at you then rolls over</li>
                        <li class="fragment">You're hungry and eat 2 strips of bacon from the oven set at 400Â°F</li>
                        <li class="fragment">Gina hands you fresh bacon and you drop it because it's too hot
                            <ul>
                                <li class="fragment">5 pieces fall to the ground</li>
                                <li class="fragment">No more bacon</li>
                            </ul>
                        </li>
                        <li class="fragment">How many bacon strips were <span class="red">prepared</span> today?</li>
                        <li class="fragment">How many bacon strips were <span class="red">eaten</span> today?</li>
                    </ul>
                </section>

                <section data-transition="none">
                    <pre><code class="php" data-trim>
for ($i = 0, $for_max = count($cached_inserts); $i < $for_max; $i++) {
    if ($smarty->debugging) {
        $_params = array();
        require_once(SMARTY_CORE_DIR . 'core.get_microtime.php');
    }
    $args = unserialize($insert_args[$i]); $name = $args['name'];

    if (isset($args['script'])) {
        if(!smarty_core_get_php_resource($_params, $smarty)) {
            return false;
        }
        $php_resource = $_params['php_resource'];

        if ($resource_type == 'file') {
            $smarty->_include($php_resource, true);
        } else {
            $smarty->_eval($php_resource);
        }
    }

    $params['results'] = substr_replace($params['results'], $replace, strpos($params['results'], $cached_inserts[$i]), strlen($cached_inserts[$i]));
    if ($smarty->debugging) {
        $_params = array();
        require_once(SMARTY_CORE_DIR . 'core.get_microtime.php');
        $smarty->_smarty_debug_info[] = array('type'      => 'insert',
                                              'exec_time' => smarty_core_get_microtime($_params, $smarty) - $debug_start_time);
    }
}

return $params['results'];
</code></pre>
                </section>

                <section>
                    <h3>Dogs, Strips of Bacon, Gina</h3>
                    <ul>
                        <li class="fragment fade-out visible">3 dogs run into the your living room</li>
                        <li>Gina feeds <span class="fragment fade-out visible">each dog</span> <span class="fragment">2 dogs</span> a strip of bacon
                            <ul class="fragment fade-out visible"><li>except Spackle because he pooped on the floor earlier</li></ul></li>
                        <li class="fragment fade-out visible">Spot wags her tail looking at you then rolls over</li>
                        <li>You<span class="class="fragment fade-out visible"">'re hungry and</span> eat 2 strips of bacon<span class="fragment fade-out visible"> from the oven set at 400Â°F</span></li>
                        <li>Gina hands you more bacon and you drop <span class="fragment fade-out visible">it because it's too hot</span>
                            <ul>
                                <li>5 pieces <span class="fragment fade-out visible">fall to the ground</span></li>
                                <li>No more bacon</li>
                            </ul>
                        </li>
                        <li>How many bacon strips were <span class="red">prepared</span> today?</li>
                        <li>How many bacon strips were <span class="red">eaten</span> today?</li>
                    </ul>
                </section>

                <section>
                    <img src="images/comic1.png" class="stretch no-border">
                    <!-- https://twitter.com/detly/status/394755439314755584 -->
                </section>

                <section>
                    <img src="images/comic2.png" class="stretch no-border">
                    <!-- https://twitter.com/detly/status/394755439314755584 -->
                </section>

                <section>
                    <img src="images/comic3.png" class="stretch no-border">
                    <!-- https://twitter.com/detly/status/394755439314755584 -->
                </section>

                <section>
                    <h3>A program cannot change<br>until it is alive in a programmer's head.</h3>
                    <h4 style="margin-top:2em">&ndash;Jessica Kerr on <a href="https://devchat.tv/ruby-rogues/">Ruby Rogues Podcast</a></h4>
                </section>

                <section data-transition="none">
                    <h5>Nested Control Structures :(</h5>

                    <pre><code class="php" data-trim>
$users = User::all();

foreach ($users as $user) {
    if (is_admin($user)) {
        echo "ID: " . $user->id . " Name: " . $user->name . "<br>";
        
        foreach ($user->groups as $group) {
            if (!in_array($group->admin, $users)) {
                continue;
            }
            echo "Group Admin: " . $user->name . "<br>";
        }
    } else {
        foreach ($user->activities as $activity) {
            echo "Activities: ";
            if ($activity->isActive()) {
                echo $activity->name . "<br>";
            }
        }
    }
}
</code></pre>
                </section>

                <section data-transition="none">
                    <!--
    "control structure"
    This is "imperative" programming.
    Each control structure is another level deeper.
    Potentially new rules are in effect,
    new variables are defined or maybe they're not used any more?

    Why do each of these exist? Are they simply minor details or whole new contexts?
    Each foreach() is its own mini-program, its own area of concerns.
    
    When is it safe to forget about the context we built up in that block?
-->
                    <h5>Control Structure Anxiety</h5>

                    <pre class="fragment"><code class="php" data-trim>
foreach (...) {
    if (...) {
        foreach (...) {
            if (...) {
                // ...
            }
        }
    } else {
        foreach (...) {
            if (...) {
                // ...
            }
        }
    }
}
</code></pre>

                    <ul class="fragment">
                        <li>New rules?<!-- are potentially in effect--></li>
                        <li>New variables?<!-- are introduced. When is it safe to forget about them? Flush out context and move on? --></li>
                        <li>Minor details vs New contexts</li>
                    </ul>
                </section>

                <section>
                    <!-- ctrl + F for... value, custom, entry -->
                    <h5>Readability :(</h5>
                    <pre><code class="php" data-trim>
$customFieldValues = $this->getRequestParam("customFieldValues");
if ($customFieldValues) {
    foreach ($customFieldValues as $custValueInfo) {
        $valueEntry = $reservation->getCustomFieldValueEntry($custValueInfo['id']);
        // Not found, this is the first time they're setting the value, so we need
        // to create a new entry
        if (!$valueEntry) {
            $customField = $resource->getCustomField($custValueInfo['id']);
            if (!$customField) {
                throw new \InvalidArgumentException("Attempted to set a custom field that does not belong to the specified Resource");
            }

            $valueEntry = new ReservationCustomFieldValueEntry();
            $valueEntry->setField($customField);
            $reservation->addCustomFieldValue($valueEntry);
        }

        $valueEntry->setValue($custValueInfo['value']);
    }
}
</code></pre>
                </section>

                <section>
                    <h5>Local variables are noisy :(</h5>
                    <!--
                    Some literature encourages extracting variables for "readability"
                        I think this often does the opposite.
                        Once a variable exists a reader must mentally keep track of it.
                        Working Memory and mental slots
                    Variable for long-chained methods?
                    Timid code in case Students is empty?
                    When can we forget about these variables defined above?
                    -->
                    <pre><code class="php" data-trim>
public function getOldestStudentAction(Request $request) {
    $method = $request->getMethod();
    if ($method !== 'PUT') {
        throw new \BadRequestMethod('Endpoint only accepts PUT requests');
    }

    $db = $this->getDatabase()->getConnection();
    $roster = $db->query('Roster', $request->get('roster_id'));

    $oldest = null;
    foreach ($roster->getStudents() as $student) {
        if (!$oldest || $student->getAge() > $oldest->getAge()) {
            $oldest = $student;
        }
    }

    $oldestName = $oldest->getName();
    echo "The oldest student is " . $oldestName . "\n";
    $db->close();
    $roster->updateLastAccess();

    // $method, $db, $roster, $request, $oldest, $student, $oldestName
}
</code></pre>
                </section>

                <section>
                    <h5>Ruthlessly Eliminate Local Variables</h5>
                    <!-- Readable, Reasonable -->
                    <pre><code class="php" data-trim>
$method = $request->getMethod();
if ($method !== 'POST') {
    // ...
}
</code></pre>
                    <pre><code class="php" data-trim>
if ($request->getMethod() !== 'POST') {
    // ...
}
</code></pre>
                </section>

                <section data-transition="none">
                    <!-- Sandy Metz - 99 Bottles Page 64/65
                    if/else checks wildly different cases; who knows what we'll find inside those parens
                    switch says we are going to examine ONE value and do different things when it equals different values

                    This is subtle, but encodes intentions into the code
                -->
                    <h5>If/Else vs Switch/Case</h5>

                    <pre class="fragment"><code class="php" data-trim>
if ($number === 1) {
    // Do something
} else if ($number === 2) {
    // Do something else
} else {
    // Last case
}
</code></pre>

                    <pre class="fragment"><code class="php" data-trim>
switch ($number) {
    case 1:
        // Do something
        break;
    case 2:
        // Do something else
        break;
    default:
        // Last case
        break;
</code></pre>
                </section>

                <section>
                    <h5>Chain Method Calls</h5>
                    <!-- Readable, Reasonable -->
                    <pre><code class="php" data-trim>
$db = $this->getDatabase();
$conn = $db->getConnection();
$roster = $conn->query('Roster', $request->get('roster_id'));
</code></pre>
                    <pre><code class="php" data-trim>
$roster = $this
    ->getDatabase()
    ->getConnection()
    ->query('Roster', $request->get('roster_id'));
</code></pre>
                    <!-- Yes, dependency injection is a thing but it's another topic -->
                </section>

                <section>
                    <h5>array ==> map ==> filter ==> reduce</h5>
                    <pre class="fragment" style="width:80%"><code class="php stretch" data-trim>
// 1. Multiply by 2
// 2. Remove any results over 9
// 3. Add numbers together
</code></pre>
<pre style="width:80%" class="fragment"><code class="php stretch" data-trim>
$start = [1, 2, 3, 4, 5];

echo array_reduce(array_filter(array_map(function ($i) {
    return $i * 2;
}, $start), function ($i) {
    return $i < 9;
}), function ($sum, $i) {
    return $sum + $i;
}, 0);

// "20"
</code></pre>
<pre style="width:80%" class="fragment"><code class="php stretch" data-trim>
array_map($fn, $array, [$...])
array_filter($array, $fn)
array_reduce($array, $fn, $initial)
</code></pre>
                </section>

                <section data-transition="none">
                    <img src="images/wat.jpg" class="no-border" style="width:40%">
                </section>

                <section>
<pre><code class="php" data-trim>
$friends = ['John', 'Chris', 'Penelope', 'Megan'];

echo join(", ", addGreeting(keepUnderLength(6, $friends)));

// "Hello John, Hello Chris, Hello Megan"
</code></pre>
<pre class="fragment"><code class="php" data-trim>
$friends = ['John', 'Chris', 'Penelope', 'Megan'];

$short = keepUnderLength(6, $friends);
$greeted = addGreeting($short);
$result = join(", ", $greeted);

echo $result; // "Hello John, Hello Chris, Hello Megan"
</code></pre>
                <!--
                where have we seen this?
                wouldn't it be great if we could pass output as input to the next function?
            -->
                </section>

                <section>
                    <img src="images/mcilroy.jpg" style="width:35%" class="no-border">
                    <h5>Doug McIlroy<br><span class="fragment">Inventor of Unix pipes in 1972<small><sup>[<a href="http://www.softpanorama.org/Scripting/Piporama/history.shtml">1</a>]</sup></small></span></h5>
                </section>

                <section>
                    <h5>Unix Pipes</h5>
                    <pre><code class="bash" data-trim>
$ cat friends.txt
John
Chris
Penelope
Megan
</code></pre>
                    <pre class="fragment"><code class="bash" data-trim>
$ cat friends.txt | awk 'length($0) < 6'
John
Chris
Megan
</code></pre>
                    <pre class="fragment"><code class="bash" data-trim>
$ cat friends.txt | awk 'length($0) < 6' | xargs -L1 echo "Hello"
Hello John
Hello Chris
Hello Megan
</code></pre>
<!--
    English reads left to right, top to bottom
    Each program is small, self-contained and can't interfere with the other
-->
                </section>

                <section data-transition="none">
                    <img src="images/small-programs/1.png" class="stretch no-border">
                </section>
                <section data-transition="none">
                    <img src="images/small-programs/2.png" class="stretch no-border">
                </section>
                <section data-transition="none">
                    <img src="images/small-programs/3.png" class="stretch no-border">
                </section>
                <section data-transition="none">
                    <img src="images/small-programs/4.png" class="stretch no-border">
                </section>
                <section data-transition="none">
                    <img src="images/small-programs/5.png" class="stretch no-border">
                </section>
                <section data-transition="none">
                    <img src="images/small-programs/6.png" class="stretch no-border">
                </section>
                <section data-transition="none">
                    <img src="images/small-programs/7.png" class="stretch no-border">
                </section>

                <section data-background="#222">
                    <h3 style="color:#fff">Microservices can be data pipelines</h3>
                    <img src="images/network-services-pipeline.png" class="no-border stretch">
                    <!-- https://joind.in/event/sunshinephp-2016/building-real-time-data-pipelines -->
                    <p style="color:#fff"><small>c/o Samantha QuiÃ±ones, "Building Real-Time Metric Pipelines"</small></p>
                </section>

                <section>
                    <h5>Pipelines</h5>
                    <pre><code class="php" data-trim>
$friends = new \Haystack\HArray(['John', 'Chris', 'Penelope', 'Megan']);
$greetings = $friends->filter(...)->map(...)->toArray();

// ["Hello John", "Hello Chris", "Hello Megan"]
</code></pre>
                    <pre class="fragment"><code class="php" data-trim>
class HArray extends \ArrayObject
{
    private $array = [];
    public function __construct(array $a = []) {
        $this->array = $a;
    }
    public function map(callable $func) {
        return new static(array_map($func, $this->array));
    }
    public function filter(callable $func = null) {
        return new static(array_filter($this->array, $func));
    }
    public function reduce(callable $func, $initial = null) {
        return array_reduce($this->array, $func, $initial);
    }
}
</code></pre>
                </section>

                <section>
                    <h5>Pipelines</h5>
                    <pre><code class="php" data-trim>
$friends = new \Haystack\HArray(['John', 'Chris', 'Penelope', 'Megan']);
$greetings = $friends
    ->filter(...)
    ->map(...)
    ->reduce(...)
    ->toArray();

return $greetings;
</code></pre>
                </section>

                <section data-transition="none">
                    <h5>Pipelines</h5>
                    <pre><code class="php" data-trim>
$friends = new \Haystack\HArray(['John', 'Chris', 'Penelope', 'Megan']);
$greetings = $friends
    ->filter(function ($name) {
        return ...
    })
    ->map(function ($name) {
        return ...
    })
    ->reduce(function ($name) {
        return ...
    })
    ->toArray();

return $greetings;
</code></pre>
                </section>

                <section>
                    <h3>Path to Completion</h3>
                </section>

                <section>
                    <h5>
                        Luke Wroblewski<br>
                        Web Form Design: Filling in the Blanks<br>
                        <a href="http://www.lukew.com/resources/web_form_design.asp" class="visible-link">lukew.com/resources/web_form_design.asp</a>
                    </h5>
                    <!-- Product Director at Google,
                    previously:
                    Chief Design Architect (VP) at Yahoo!
                    Lead User Interface Designer at eBay -->
                    <img src="images/web-forms-cover.png" style="width:40%" class="no-border">
                </section>

                <section>
                    <img src="images/path-to-completion-broken.png" class="stretch no-border">
                    <!-- http://static.lukew.com/webforms_lukew.pdf -->
                </section>

                <section>
                    <img src="images/path-to-completion-happy.png" class="stretch no-border">
                    <!-- http://static.lukew.com/webforms_lukew.pdf -->
                </section>

                <section>
                    <h5>Pipelines</h5>
                    <pre style="width:80%"><code class="php stretch" data-trim>
// 1. Multiply by 2
// 2. Remove any results over 9
// 3. Add numbers together

$start = [1, 2, 3, 4, 5];

echo (new \Haystack\HArray($start))
    ->map(function ($i) {
        return $i * 2;
    })
    ->filter(function ($i) {
        return $i < 9;
    })
    ->reduce(function ($sum, $i) {
        return $sum + $i;
    });

// 20
</code></pre>
                </section>

                <section data-transition="none">
                    <h3>Refactor to Pipelines</h3>
                </section>

                <section data-transition="none">
                    <video data-autoplay class="stretch">
                        <source data-src="video/stage0.mov" type="video/mp4" />
                    </video>
                </section>
                <section data-transition="none">
                    <video data-autoplay class="stretch">
                        <source data-src="video/stage1.mov" type="video/mp4" />
                    </video>
                </section>
                <section data-transition="none">
                    <video data-autoplay class="stretch">
                        <source data-autoplay data-src="video/stage2.mov" type="video/mp4" />
                    </video>
                </section>
                <section data-transition="none">
                    <video data-autoplay class="stretch">
                        <source data-autoplay data-src="video/stage3.mov" type="video/mp4" />
                    </video>
                </section>
                <section data-transition="none">
                    <video data-autoplay class="stretch">
                        <source data-autoplay data-src="video/stage4.mov" type="video/mp4" />
                    </video>
                </section>
                <section data-transition="none">
                    <video data-autoplay class="stretch">
                        <source data-autoplay data-src="video/stage5.mov" type="video/mp4" />
                    </video>
                </section>
                <section data-transition="none">
                    <video data-autoplay class="stretch">
                        <source data-autoplay data-src="video/stage6.mov" type="video/mp4" />
                    </video>
                </section>
                <section data-transition="none">
                    <video data-autoplay class="stretch">
                        <source data-autoplay data-src="video/stage7.mov" type="video/mp4" />
                    </video>
                </section>
                <section data-transition="none">
                    <video data-autoplay class="stretch">
                        <source data-autoplay data-src="video/stage8.mov" type="video/mp4" />
                    </video>
                </section>
                <section data-transition="none">
                    <video data-autoplay class="stretch">
                        <source data-autoplay data-src="video/stage9.mov" type="video/mp4" />
                    </video>
                </section>
                <section data-transition="none">
                    <video data-autoplay class="stretch">
                        <source data-autoplay data-src="video/stage10.mov" type="video/mp4" />
                    </video>
                </section>
                <section data-transition="none">
                    <video data-autoplay class="stretch">
                        <source data-autoplay data-src="video/stage11.mov" type="video/mp4" />
                    </video>
                </section>
                <section data-transition="none">
                    <video data-autoplay class="stretch">
                        <source data-autoplay data-src="video/stage12.mov" type="video/mp4" />
                    </video>
                </section>

                <section>
                    <h3>Exercise: Find all classes to instantiate</h3>
                </section>

                <section data-transition="none">
                    <pre><code class="bash" data-trim>
$ tree /projects/loops/src
src
â””â”€â”€ FizzBuzz
 Â Â  â”œâ”€â”€ Canonical.php            class Canonical {}
 Â Â  â”œâ”€â”€ Haystack.php             class Haystack {}
 Â Â  â””â”€â”€ SomeInterface.php        interface SomeInterface {}
</code></pre>
<pre class="fragment"><code class="php" data-trim>
kataProvider('FizzBuzz');
// [  "\\RethinkingLoops\\FizzBuzz\\Canonical",
//    "\\RethinkingLoops\\FizzBuzz\\Haystack" ]
</code></pre>
<pre class="fragment"><code class="php" data-trim>
function kataProvider($dir) {
    $src = realpath(__DIR__ . '/../src/' . $dir);
    $classes = [];
    foreach (scandir($src) as $filename) {
        // [  ".",
        //    "..",
        //    "Canonical.php",
        //    "Haystack.php",
        //    "SomeInterface.php" ]
    }

    return $classes;
}
</code></pre>
                </section>
                <section data-transition="none">
<pre><code class="php" data-trim>
function kataProvider($dir) {
    $src = realpath(__DIR__ . '/../src/' . $dir);

    $classes = [];
    foreach (scandir($src) as $filename) {
        $path = sprintf('%s/%s', $src, $filename);
        // [
        //     "/projects/loops/src/FizzBuzz/.",
        //     "/projects/loops/src/FizzBuzz/..",
        //     "/projects/loops/src/FizzBuzz/Canonical.php",
        //     "/projects/loops/src/FizzBuzz/Haystack.php",
        //     "/projects/loops/src/FizzBuzz/SomeInterface.php",
        // ]
    }

    return $classes;
}
</code></pre>
                </section>
                <section data-transition="none">
<pre><code class="php" data-trim>
function kataProvider($dir) {
    $src = realpath(__DIR__ . '/../src/' . $dir);

    $classes = [];
    foreach (scandir($src) as $filename) {
        $path = sprintf('%s/%s', $src, $filename);
        if (false === is_dir($path)) {
            // [
            //     "/projects/loops/src/FizzBuzz/Canonical.php",
            //     "/projects/loops/src/FizzBuzz/Haystack.php",
            //     "/projects/loops/src/FizzBuzz/SomeInterface.php",
            // ]
        }
    }

    return $classes;
}
</code></pre>
                </section>
                <section data-transition="none">
<pre><code class="php" data-trim>
function kataProvider($dir) {
    $src = realpath(__DIR__ . '/../src/' . $dir);

    $classes = [];
    foreach (scandir($src) as $filename) {
        $path = sprintf('%s/%s', $src, $filename);
        if (false === is_dir($path)) {
            $path = str_replace('.php', '', $path);
            // [
            //     "/projects/loops/src/FizzBuzz/Canonical",
            //     "/projects/loops/src/FizzBuzz/Haystack",
            //     "/projects/loops/src/FizzBuzz/SomeInterface",
            // ]
        }
    }

    return $classes;
}
</code></pre>
                </section>
                <section data-transition="none">
<pre><code class="php" data-trim>
function kataProvider($dir) {
    $src = realpath(__DIR__ . '/../src/' . $dir);

    $classes = [];
    foreach (scandir($src) as $filename) {
        $path = sprintf('%s/%s', $src, $filename);
        if (false === is_dir($path)) {
            $path = str_replace('.php', '', $path);
            $fqcn = str_replace($src . '/', '\\RethinkingLoops\\' . $dir . '\\', $path);
            // [
            //     "\\RethinkingLoops\\FizzBuzz\\Canonical",
            //     "\\RethinkingLoops\\FizzBuzz\\Haystack",
            //     "\\RethinkingLoops\\FizzBuzz\\SomeInterface",
            // ]
        }
    }

    return $classes;
}
</code></pre>
                </section>
                <section data-transition="none">
<pre><code class="php" data-trim>
function kataProvider($dir) {
    $src = realpath(__DIR__ . '/../src/' . $dir);

    $classes = [];
    foreach (scandir($src) as $filename) {
        $path = sprintf('%s/%s', $src, $filename);
        if (false === is_dir($path)) {
            $path = str_replace('.php', '', $path);
            $fqcn = str_replace($src . '/', '\\RethinkingLoops\\' . $dir . '\\', $path);

            $r = new \ReflectionClass($fqcn);
            if (false === $r->isAbstract()) {
                $classes[] = $fqcn;
            }
            // [ "\\RethinkingLoops\\FizzBuzz\\Canonical",
            //   "\\RethinkingLoops\\FizzBuzz\\Haystack" ]
        }
    }

    return $classes;
}
</code></pre>
                </section>
                <section data-transition="none">
<pre><code class="php" data-trim>
function kataProvider($dir) {
    $src = realpath(__DIR__ . '/../src/' . $dir);

    $classes = [];
    foreach (scandir($src) as $filename) {
        $path = sprintf('%s/%s', $src, $filename);
        if (false === is_dir($path)) {
            $path = str_replace('.php', '', $path);
            $fqcn = str_replace($src . '/', '\\RethinkingLoops\\' . $dir . '\\', $path);

            $r = new \ReflectionClass($fqcn);
            if (false === $r->isAbstract()) {
                $classes[] = $fqcn;
                // $dir, $src, $classes, $filename, $path, $fqcn, $r
            }
        }
    }

    return $classes;
}
</code></pre>
                </section>

                <section>
                    <h2>Refactor to array_*</h2>
                </section>

                <section data-transition="none">
<pre><code class="php" data-trim>
function kataProvider($dir) {
    $src = realpath(__DIR__ . '/../src/' . $dir);

    $paths = array_map(function ($filename) use ($src) {
        return sprintf('%s/%s', $src, $filename);
    }, scandir($src));

    $files = array_filter($paths, function ($path) {
        return false === is_dir($path);
    });

    $allClasses = array_map(function ($path) use ($src, $dir) {
        $path = str_replace('.php', '', $path);
        return str_replace($src . '/', '\\RethinkingLoops\\' . $dir . '\\', $path);
    }, $files);

    return array_filter($allClasses, function ($class) {
        return false === (new \ReflectionClass($fqcn))->isAbstract();
    });
}
</code></pre>
                </section>

                <section>
                    <h2>Refactor to Pipeline</h2>
                </section>

                <section data-transition="none">
<pre><code class="php" data-trim>
function kataProvider($dir) {
    $src = realpath(__DIR__ . '/../src/' . $dir);
    // "/projects/loops/src/FizzBuzz/"

    return (new \Haystack\HArray(scandir($src)))
        // [
        //    ".",
        //    "..",
        //    "Canonical.php",
        //    "Haystack.php",
        //    "SomeInterface.php",
        // ]
}
</code></pre>
                </section>
                <section data-transition="none">
<pre><code class="php" data-trim>
function kataProvider($dir) {
    $src = realpath(__DIR__ . '/../src/' . $dir);

    return (new \Haystack\HArray(scandir($src)))
        ->map(function ($filename) use ($src) {
            return sprintf('%s/%s', $src, $filename);
        })
        // [
        //     "/projects/loops/src/FizzBuzz/.",
        //     "/projects/loops/src/FizzBuzz/..",
        //     "/projects/loops/src/FizzBuzz/Canonical.php",
        //     "/projects/loops/src/FizzBuzz/Haystack.php",
        //     "/projects/loops/src/FizzBuzz/SomeInterface.php",
        // ]
}
</code></pre>
                </section>
                <section data-transition="none">
<pre><code class="php" data-trim>
function kataProvider($dir) {
    $src = realpath(__DIR__ . '/../src/' . $dir);

    return (new \Haystack\HArray(scandir($src)))
        ->map(function ($filename) use ($src) {
            return sprintf('%s/%s', $src, $filename);
        })
        ->filter(function ($path) {
            return false === is_dir($path);
        })
        // [
        //     "/projects/loops/src/FizzBuzz/Canonical.php",
        //     "/projects/loops/src/FizzBuzz/Haystack.php",
        //     "/projects/loops/src/FizzBuzz/SomeInterface.php",
        // ]
}
</code></pre>
                </section>
                <section data-transition="none">
<pre><code class="php" data-trim>
function kataProvider($dir) {
    $src = realpath(__DIR__ . '/../src/' . $dir);

    return (new \Haystack\HArray(scandir($src)))
        ->map(function ($filename) use ($src) {
            return sprintf('%s/%s', $src, $filename);
        })
        ->filter(function ($path) {
            return false === is_dir($path);
        })
        ->map(function ($filepath) use ($src, $dir) {
            $filepath = str_replace('.php', '', $filepath);
            return str_replace($src . '/', '\\RethinkingLoops\\' . $dir . '\\', $filepath);
        })
        // [ "\\RethinkingLoops\\FizzBuzz\\Canonical",
        //   "\\RethinkingLoops\\FizzBuzz\\Haystack",
        //   "\\RethinkingLoops\\FizzBuzz\\SomeInterface" ]
}
</code></pre>
                </section>
                <section data-transition="none">
<pre><code class="php" data-trim>
function kataProvider($dir) {
    $src = realpath(__DIR__ . '/../src/' . $dir);

    return (new \Haystack\HArray(scandir($src)))
        ->map(function ($filename) use ($src) {
            return sprintf('%s/%s', $src, $filename);
        })
        ->filter(function ($path) {
            return false === is_dir($path);
        })
        ->map(function ($filepath) use ($src, $dir) {
            $filepath = str_replace('.php', '', $filepath);
            return str_replace($src . '/', '\\RethinkingLoops\\' . $dir . '\\', $filepath);
        })
        ->filter(function ($fqcn) {
            return false === (new \ReflectionClass($fqcn))->isAbstract();
        })
        ->toArray();
        // [ "\\RethinkingLoops\\FizzBuzz\\Canonical",
        //   "\\RethinkingLoops\\FizzBuzz\\Haystack" ]
}
</code></pre>
                </section>
                <section data-transition="none">
<pre><code class="php" data-trim>
function kataProvider($dir) {
    $src = realpath(__DIR__ . '/../src/' . $dir);

    return (new \Haystack\HArray(scandir($src)))
        ->map(function ($filename) use ($src) {
            return sprintf('%s/%s', $src, $filename);
        })
        ->filter(function ($path) {
            return false === is_dir($path);
        })
        ->map(function ($filepath) use ($src, $dir) {
            $filepath = str_replace('.php', '', $filepath);
            return str_replace($src . '/', '\\RethinkingLoops\\' . $dir . '\\', $filepath);
        })
        ->filter(function ($fqcn) {
            return false === (new \ReflectionClass($fqcn))->isAbstract();
        })
        ->toArray();
}
</code></pre>
                </section>

                <section>
                    <h5>Available Today!</h5>
                    <ul class="link-list">
                        <li>Haystack - <a href="https://github.com/ericpoe/haystack">github.com/ericpoe/haystack</a></li>
                        <li>Laravel Collections - <a href="https://laravel.com/docs/5.2/collections">laravel.com/docs/5.2/collections</a></li>
                        <li>Doctrine Collections - <a href="https://github.com/doctrine/collections">github.com/doctrine/collections</a></li>
                    </ul>
                </section>

                <section>
                    <h3>The Future in PHP?</h3>
                </section>

                <section>
                    <h5>PHP RFC: Pipe Operator |&gt;</h5>
                    <pre><code class="php" data-trim>
$response = loadConfig()
    |> buildDic($$)
    |> getApp($$)
    |> getRouter($$)
    |> getDispatcher($$, $request)
    |> dispatchBusinessLogic($$, $request, new Response())
    |> renderResponse($$)
    |> buildPsr7Response($$)
    |> emit($$);
</code></pre>
                    <a href="https://wiki.php.net/rfc/pipe-operator" class="visible-link">wiki.php.net/rfc/pipe-operator</a>
                    <h5>In discussion, targeting PHP 7.2</h5>
                </section>

                <section>
                    <h5>PHP RFC: Pipe Operator |&gt;</h5>
                    <pre><code class="php" data-trim>
function kataProvider($dir) {
    $src = realpath(__DIR__ . '/../src/' . $dir);

    return scandir($src)
        |> array_map(function ($filename) use ($src) {
            return sprintf('%s/%s', $src, $filename);
        }, $$)
        |> array_filter($$, function ($path) {
            return false === is_dir($path);
        })
        |> array_map(function ($filepath) use ($src, $dir) {
            $filepath = str_replace('.php', '', $filepath);
            return str_replace($src . '/', '\\RethinkingLoops\\' . $dir . '\\', $filepath);
        }, $$)
        |> array_filter($$, function ($fqcn) {
            return false === (new \ReflectionClass($fqcn))->isAbstract();
        });
}
</code></pre>
                    <a href="https://wiki.php.net/rfc/pipe-operator" class="visible-link">wiki.php.net/rfc/pipe-operator</a>
                    <h5>In discussion, targeting PHP 7.2</h5>
                </section>

                <section>
                    <h5>PHP RFC: Arrow Functions</h5>
                    <pre><code class="php" data-trim>
$elements = [1, 3, 5];

// live
$result = array_map(function($x) { return $x * 2; }, $elements);
 
// proposed
$result = array_map(function($x) => $x * 2, $elements);
</code></pre>
                    <a href="https://wiki.php.net/rfc/arrow_functions" class="visible-link">wiki.php.net/rfc/arrow_functions</a>
                    <h5>In discussion, targeting PHP 7.2</h5>
                </section>

                <section>
                    <h5>PHP RFC: Arrow Functions</h5>
                    <pre><code class="php" data-trim>
$friends = new \Haystack\HArray(['John', 'Chris', 'Penelope', 'Megan']);

$greetings = $friends
    ->filter(function ($name) => strlen($name) < 6)
    ->map(function ($name) => 'Hello ' . $name);

echo join(", ", $greetings->toArray());
// "Hello John, Hello Chris, Hello Megan"
</code></pre>
                    <a href="https://wiki.php.net/rfc/arrow_functions" class="visible-link">wiki.php.net/rfc/arrow_functions</a>
                    <h5>In discussion, targeting PHP 7.2</h5>
                </section>

                <section>
                    <h3>The Future in Web?</h3>
                </section>

                <section>
                    <img src="images/streams.jpg" class="no-border">
                </section>

                <section>
                    <h5>Rethinking Loops Playground</h5>
                    <pre><code class="bash" data-trim>
$ composer create-project johnkary/rethinking-loops
</code></pre>
                </section>

                <section>
                    <h5>Your Homework</h5>
                    <ul class="link-list-small">
                        <li>Collection Pipeline Design Techniques<br><a href="http://www.infoq.com/presentations/collection-pipelines" class="visible-link">infoq.com/presentations/collection-pipelines</a></li>
                        <li>Martin Fowler on Pipelines<br><a href="http://martinfowler.com/articles/collection-pipeline/" class="visible-link">martinfowler.com/articles/collection-pipeline/</a></li>
                        <li>Refactoring To Collections<br><a href="http://adamwathan.me/refactoring-to-collections/" class="visible-link">adamwathan.me/refactoring-to-collections/</a></li>
                        <li>The Art of Unix Programming<br>
                            <a href="http://www.catb.org/esr/writings/taoup/html/index.html" class="visible-link">catb.org/esr/writings/taoup/html/</a></li>
                        <li>Functional JavaScript<br>
                            <a href="http://shop.oreilly.com/product/0636920028857.do" class="visible-link">shop.oreilly.com/product/0636920028857.do</a></li>
                        <li>Seven Languages in Seven Weeks<br><a href="https://pragprog.com/book/btlang/seven-languages-in-seven-weeks" class="visible-link">pragprog.com/book/btlang/seven-languages-in-seven-weeks</a></li>
                        <li>Structure and Interpretation of Computer Programs (SICP) <a href="https://mitpress.mit.edu/sicp/full-text/book/book.html" class="visible-link">mitpress.mit.edu/sicp/full-text/book/book.html</a></li>
                    </ul>
                </section>

                <section>
                    <pre><code class="clojure" data-trim>
(defn encode
  [#^InputStream input #^Writer output #^String alphabet line-length]
  (let [buffer (make-array Byte/TYPE 3)]
    (loop [line 0]
      (let [len (.read input buffer)]
        (when (pos? len)
          (let [b0 (Integer/valueOf (int (aget buffer 0)))
                b1 (Integer/valueOf (int (aget buffer 1)))
                b2 (Integer/valueOf (int (aget buffer 2)))]
            (cond (= len 3)
                  (let [s0 (bit-and 0x3F (bit-shift-right b0 2))
                        s1 (bit-and 0x3F
                                    (bit-or (bit-shift-left b0 4)
                                            (bit-shift-right b1 4)))
                        s2 (bit-and 0x3F
                                    (bit-or (bit-shift-left b1 2)
                                            (bit-shift-right b2 6)))
                        s3 (bit-and 0x3F b2)]
                    (.append output (.charAt alphabet s0))
                    (.append output (.charAt alphabet s1))
                    (.append output (.charAt alphabet s2))
                    (.append output (.charAt alphabet s3))))))))))
</code></pre>
                </section>

                <section>
                    <img src="images/ci.png" class="stretch" style="border:0;box-shadow:none">
                </section>

                <section>
                    <pre class="fragment"><code class="php" data-trim>
$list = [2, 4, 6, 8, 10];

for ($i=0; $i < count($list); $i++) {
    $current = $start[$i];
    $end[] = $current = *;
}

foreach ($list as $idx => $value) {
    echo $value;
    unset($list[$idx]);
}
</code></pre>
                </section>

                <section>
                    <pre style="width:80%"><code class="php stretch" data-trim>
$start = [1, 2, 3, 4, 5];

echo (new \Haystack\HArray($start))
    ->map(function ($i) {
        return $i * 2;
    })
    ->filter(function ($i) {
        return $i < 9;
    })
    ->reduce(function ($sum, $i) {
        return $sum + $i;
    });

// 20
</code></pre>
                </section>

                <section>
                    <h3>Bugs cannot exist<br>in code that doesn't exist</h3>
                    <h3 class="fragment" style="margin-top:1em;">Be Expressive</h3>
                    <h3 class="fragment" style="margin-top:1em;">Thanks.</h3>
                </section>

                <section>
                    <h5>Sources</h5>
                    <ul class="link-list-very-small">
                        <li>Title slide background<br><a href="https://www.flickr.com/photos/tbrianjones/22135624309/" class="visible-link">https://www.flickr.com/photos/tbrianjones/22135624309/</a></li>
                        <li>FizzBuzz without control structures tweet by John Kary<br><a href="https://twitter.com/johnkary/status/596163674743644160" class="visible-link">twitter.com/johnkary/status/596163674743644160</a></li>
                        <li>Voltron tweet by Chris Paul @idiosynchris<br><a href="https://twitter.com/idiosynchris/status/719565179801853954" class="visible-link">twitter.com/idiosynchris/status/719565179801853954</a></li>
                        <li>Wolves painting<br><a href="http://s278.photobucket.com/user/trueSoulWolfDemon/media/Wolves/Wolvesb.jpg.html">s278.photobucket.com/user/trueSoulWolfDemon/media/Wolves/Wolvesb.jpg.html</a></li>
                        <li>Playing chess on roller coasters (xkcd)<br><a href="https://xkcd.com/chesscoaster/" class="visible-link">xkcd.com/chesscoaster/</a></li>
                        <li>This is why you shouldn't interrupt a programmer<br><a href="https://twitter.com/detly/status/394755439314755584" class="visible-link">twitter.com/detly/status/394755439314755584</a></li>
                        <li>Building Real-Time Data Pipelines by Samantha QuiÃ±ones<br><a href="https://joind.in/event/sunshinephp-2016/building-real-time-data-pipelines" class="visible-link">joind.in/event/sunshinephp-2016/building-real-time-data-pipelines</a></li>
                        <li>Best Practices For Form Design by Luke Wroblewski<br><a href="http://static.lukew.com/webforms_lukew.pdf" class="visible-link">static.lukew.com/webforms_lukew.pdf</a></li>
                        <li>Picture of Douglas McIlroy<br><a href="https://en.wikipedia.org/wiki/Douglas_McIlroy" class="visible-link">en.wikipedia.org/wiki/Douglas_McIlroy</a></li>
                        <li>Adam Wathan pipeline code tweet<br><a href="https://twitter.com/adamwathan/status/666819102581788672" class="visible-link">twitter.com/adamwathan/status/666819102581788672</a></li>
                        <li>This Is Not A Pipe<br><a href="http://www.wikiart.org/en/rene-magritte/the-treachery-of-images-this-is-not-a-pipe-1948" class="visible-link">www.wikiart.org/en/rene-magritte/the-treachery-of-images-this-is-not-a-pipe-1948</a></li>
                    </ul>
                </section>

                <section data-background="images/questions-bg.jpg">
                    <h3>Questions?</h3>
                    <p><img src="images/this-is-not-a-pipe.jpg" style="width:43%"></p>
                    <p>
                        <small>
                            John Kary</a> &nbsp;â€¢&nbsp; <a href="https://twitter.com/johnkary">@johnkary</a><br><br>
                            Slides: <a href="http://johnkary.net/talks">johnkary.net/talks</a><br>
                            Feedback: <a href="https:///joind.in/talk/a7c43">joind.in/talk/a7c43</a>
                        </small>
                    </p>
                    <div id="license"><a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="images/cc-88x31.png" /></a><br /><span xmlns:dct="http://purl.org/dc/terms/" property="dct:title">Rethinking Loops</span> by <a xmlns:cc="http://creativecommons.org/ns#" href="http://johnkary.net/talks" property="cc:attributionName" rel="cc:attributionURL">John Kary</a> is licensed under a<br><a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>.</div>
                </section>

                <section>
                    <h3>Performance?</h3>
                    <ul class="link-list">
                        <li>Arrays vs Objects Benchmarks (5.6, 7.0)<br><a href="http://bit.ly/rethinking-loops-perf-1" class="visible-link">http://bit.ly/rethinking-loops-perf-1</a></li>
                        <li>Why objects (usually) use less memory than arrays in PHP<br><a href="http://bit.ly/rethinking-loops-perf-2" class="visible-link">http://bit.ly/rethinking-loops-perf-2</a></li>
                    </ul>
                </section>

                <section>
                    <h3 style="margin-top:1em">Benchmark!</h3>

                    <a href="https://blackfire.io"><img src="images/blackfire-logo-1500px.png" class="no-border" style="width:50%;"></a>
                </section>

                <section>
                    <a href="https://blackfire.io">https://blackfire.io</a><br>
                    <img src="images/blackfire-screenshot.png" class="no-border">
                </section>

                <section>
                    <h3>Handling Errors?</h3>
                    <p>
                        Railway Oriented Programming:<br>A functional approach to error handling<br><a href="https://fsharpforfunandprofit.com/rop/" class="visible-link">fsharpforfunandprofit.com/rop/</a>
                    </p>

                    <img src="images/railway.png">

                </section>

                <section>
                    <h1>:)</h1>
                </section>

                <section>
                    <h5>Why Arrays?</h5>

                    <table style="font-size:0.8em;">
                        <thead>
                            <tr>
                                <th>Quantity</th>
                                <th>One</th>
                                <th>Arrays</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>NULL</td>
                                <td>null</td>
                                <td>[]</td>
                            </tr>
                            <tr>
                                <td>0</td>
                                <td>null</td>
                                <td>[]</td>
                            </tr>
                            <tr>
                                <td>1</td>
                                <td>new User()</td>
                                <td>[new User()]</td>
                            </tr>
                            <tr>
                                <td>3</td>
                                <td>:(</td>
                                <td>[<br>
                                    new User(),<br>
                                    new User(),<br>
                                    new User(),<br>
                                    ]</td>
                            </tr>
                            <tr>
                                <td>a lot</td>
                                <td>:(</td>
                                <td>[...]</td>
                            </tr>
                        </tbody>
                    </table>
                </section>

                <!-- add code about how if/else code vs collection code -->

                <section>
                    <h5>Why Arrays?</h5>
                    <pre><code class="php" data-trim>
/** @param User[]|User|null $users */
function findUserGroups($users) {
    if ($users === null) return null;

    if ($users instanceof User) {
        $groups = Group::findByUser($users->id);
        return $groups;
    }

    if (count($users) === 0) {
        return [];
    } else {
        $groups = [];
        foreach ($users as $user) {
            $userGroups = Group::findByUser($user->id);
            if (!$groups) continue;
            $groups = array_merge($groups, $userGroups);
        }
    }

    return $groups;
}
</code></pre>
                </section>
                <section>
                    <h5>Why Arrays?</h5>
                    <pre><code class="php" data-trim>
/** @param User[]|User|null $users */
function findUserGroups($users) {
    $groups = [];

    foreach ((array) $users as $user) {
        $userGroups = Group::findByUser($user->id);
        if (!$groups) continue;
        $groups = array_merge($groups, $userGroups);
    }

    return $groups;
}
</code></pre>
                </section>
                <section>
                    <h5>Why Arrays?</h5>
                    <pre><code class="php" data-trim>
/** @param User[]|User|null $users */
function findUserGroups($users) {
    $groups = [];

    foreach ((array) $users as $user) {
        $groups = array_merge($groups, (array) Group::findByUser($user->id));
    }

    return $groups;
}
</code></pre>
                </section>
                <section>
                    <h5>Why Arrays?</h5>
                    <pre><code class="php" data-trim>
function findUserGroups($users) {
    return array_reduce((array) $users, function ($groups, $user) {
        return array_merge($groups, (array) Group::findByUser($user->id));
    }, []);
}
</code></pre>
                </section>

                <section>
                    <h1>:)</h1>
                </section>

			</div>

		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.js"></script>

		<script>

			// Full list of configuration options available at:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: false,
				progress: false,
				history: true,
				center: true,
				// width: 1024,
			    // height: 768,
                margin: 0,
                // minScale: 1.2,
                // maxScale: 1.2,

				transition: 'slide', // none/fade/slide/convex/concave/zoom

				// Optional reveal.js plugins
				dependencies: [
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'plugin/zoom-js/zoom.js', async: true },
					{ src: 'plugin/notes/notes.js', async: true }
				]
			});

		</script>

	</body>
</html>
